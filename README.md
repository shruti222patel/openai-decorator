# OpenAI Function Decorator
This Python package provides a decorator `openai_func` to help your Python functions communicate with OpenAI's API. By applying this decorator to a function, the function's signature and docstring are used to generate a spec that the OpenAI API can understand, and a request is sent to the API.

## Features
* Automatically generates a spec from your function's signature and docstring.
* Sends a request to OpenAI's API using the generated spec and a prompt.
* Uses the arguments from the API's response to call the original function.
* Allows calling your function without passing any arguments, as they are inferred from the OpenAI API response.

## Installation
To install this package, you can use pip:
```sh
pip install openai-decorator
```

## Usage
Here's a basic example of how to use the `openai` decorator:

```python
from openai_decorator import openai

@openai(prompt="Your OpenAI prompt here")
def example_function(arg1: str, arg2: int) -> str:
    """
    This is an example function.

    Args:
        arg1 (str): Description for arg1
        arg2 (int): Description for arg2

    Returns:
        str: Description for return value
    """
    return f"Your output here: {arg1} and {arg2}"

result = example_function()
print(result)
```
In this example, the decorator is applied to `example_function`. When you call `example_function()`, it actually sends a request to OpenAI's API and uses the returned arguments to execute the function.

###  Advanced Usage
The decorator handles various edge cases associated with function signatures:

Default Values: If a function parameter has a default value or has the Optional type annotation, it's optional in the JSON specification sent to OpenAI. Parameters without default values are considered required.

Type Annotations: The decorator supports a variety of type annotations. It properly handles primitive types like int, str, bool, float as well as complex types like List, Dict, Tuple, Set, Optional, and custom classes.

```python
from openai_decorator import openai_func

@openai_func(prompt="Perform mathematical operations")
def math_ops(a: int, b: int, c: float = 0.0, d: List[int] = []):
    """Performs a series of mathematical operations.

    Args:
        a: The first integer.
        b: The second integer.
        c: An optional float.
        d: An optional list of integers.
    """
    # Function body here
```
In this example, a and b are required parameters, while c and d are optional. The type annotations are correctly reflected in the generated JSON specification and the function call generated by the OpenAI API.

## Requirements
* Your function must have a well-formatted docstring that follows the Google Style. This is because the decorator reads the function's docstring to get information about its parameters and return type.
* Your function's parameters are used to generate a spec for the OpenAI API. If a parameter has a default value or is optional, it will be marked as not required in the spec.
* The OpenAI API response should contain a 'function_call' with 'name' matching the original function's name and 'arguments' that are compatible with the original function's parameters. If these conditions are not met, an error will be raised.

## Contributing
We welcome contributions to this project. Please feel free to submit issues and pull requests.

### Setup
1. Install python `3.11` and latest version of [poetry](https://python-poetry.org/docs/#installing-with-pipx)
   1. `pyenv` is a good way to manage python versions if you need to have more than 1 on your computer
2. `git clone` this repo
3. Add your openai key to your environment variables
```shell
export OPENAI_API_KEY=<insert your openai key>
```
4. Install dependencies: `poetry install --no-root`

## TODO
[ ] Handle optional parameters
[ ] Handle parameters with default values
[ ] Publish to PyPI
[ ] Add more tests
[ ] Add CI/CD

## License
This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.
